{% load tailwind_cli %} {% load django_htmx %}
<!doctype html>
<html
    lang="en"
    x-data="themeManager()"
    :data-theme="currentTheme"
    x-init="initTheme()"
>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        {% load static %}
        <script
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"
            defer
        ></script>
        {% htmx_script %}
        <title>{% block title %}Kampung Cuisine{% endblock %}</title>

        <!-- Favicon and Web App Icons -->
        <link
            rel="icon"
            type="image/svg+xml"
            href="{% static 'images/favicon.svg' %}"
        />
        <link
            rel="icon"
            type="image/x-icon"
            href="{% static 'images/favicon.ico' %}"
        />
        <link
            rel="apple-touch-icon"
            href="{% static 'images/apple-touch-icon.svg' %}"
        />
        <link rel="manifest" href="{% static 'manifest.json' %}" />
        <meta name="theme-color" content="#f97316" />

        {% tailwind_css %}
        <style>
            /* Ensure dropdown menus appear above all content */
            .dropdown-content,
            .menu {
                z-index: 9999 !important;
                position: absolute !important;
            }

            /* Specific fix for category dropdown */
            #desktop-category-menu {
                z-index: 9999 !important;
                position: absolute !important;
            }

            /* Ensure navbar stays on top */
            .navbar {
                z-index: 9998 !important;
                position: relative !important;
            }

            /* Theme selector styling */
            .theme-selector {
                transition: all 0.2s ease;
            }

            .theme-selector:hover {
                transform: scale(1.1);
            }

            .theme-selector svg {
                transition:
                    opacity 0.2s ease,
                    transform 0.2s ease;
            }

            .theme-selector:active {
                transform: scale(0.95);
            }

            /* Dark theme optimization */
            [data-theme="dark"] .bg-gradient-to-r {
                background-image: linear-gradient(to right, #f97316, #dc2626);
            }

            [data-theme="dark"] .bg-gradient-to-br {
                background-image: linear-gradient(
                    to bottom right,
                    hsl(var(--p)),
                    hsl(var(--s))
                );
            }

            /* Ensure proper contrast for images in dark mode */
            [data-theme="dark"] img {
                opacity: 0.9;
            }

            [data-theme="dark"] .shadow-xl {
                box-shadow:
                    0 20px 25px -5px rgba(0, 0, 0, 0.5),
                    0 10px 10px -5px rgba(0, 0, 0, 0.2);
            }

            [data-theme="dark"] .shadow-lg {
                box-shadow:
                    0 10px 15px -3px rgba(0, 0, 0, 0.4),
                    0 4px 6px -2px rgba(0, 0, 0, 0.2);
            }

            [data-theme="dark"] .shadow-md {
                box-shadow:
                    0 4px 6px -1px rgba(0, 0, 0, 0.3),
                    0 2px 4px -1px rgba(0, 0, 0, 0.15);
            }
        </style>
        {% block extra_css %}{% endblock %}
    </head>
    <body
        class="bg-base-200 text-base-content font-sans leading-normal tracking-normal"
    >
        <!-- Navigation with DaisyUI Navbar -->
        <div
            class="navbar bg-base-100 shadow-lg z-[9999] relative"
            x-data="{ cartCount: {{ cart_count|default:0 }} }"
        >
            <div class="navbar-start">
                <!-- Mobile menu using DaisyUI dropdown -->
                <div class="dropdown">
                    <label tabindex="0" class="btn btn-ghost lg:hidden">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 6h16M4 12h8m-8 6h16"
                            />
                        </svg>
                    </label>
                    <ul
                        tabindex="0"
                        class="menu menu-sm dropdown-content mt-3 z-[9999] p-2 shadow bg-base-100 rounded-box w-52"
                    >
                        <li><a href="/pages/about/">About</a></li>
                        <li><a href="/pages/contact/">Contact</a></li>
                        <li><a href="/admin/">Admin</a></li>
                    </ul>
                </div>
                <a href="/" class="btn btn-ghost normal-case text-xl"
                    >üçú Kampung Cuisine</a
                >
            </div>

            <div class="navbar-center hidden lg:flex">
                <ul class="menu menu-horizontal px-1">
                    <li><a href="/pages/about/">About</a></li>
                    <li><a href="/pages/contact/">Contact</a></li>
                    <li><a href="/admin/">Admin</a></li>
                </ul>
            </div>

            <div class="navbar-end">
                <!-- Shopping Cart with Badge -->
                <div class="dropdown dropdown-end">
                    <label tabindex="0" class="btn btn-ghost btn-circle">
                        <div class="indicator">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-5 w-5"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
                                />
                            </svg>
                            <span
                                class="badge badge-sm indicator-item badge-primary"
                                x-show="cartCount > 0"
                                x-text="cartCount"
                                data-cart-count
                            ></span>
                        </div>
                    </label>
                    <div
                        tabindex="0"
                        class="mt-3 z-[9999] card card-compact dropdown-content w-64 bg-base-100 shadow-xl"
                    >
                        <div class="card-body">
                            <span class="font-bold text-lg">
                                <span x-text="cartCount" data-cart-count
                                    >{{ cart_count|default:0 }}</span
                                >
                                item<span x-show="cartCount !== 1">s</span> in
                                your cart
                            </span>
                            <span class="text-info"
                                >Total: $<span data-cart-total
                                    >{{ cart_total|default:"0.00" }}</span
                                ></span
                            >
                            <div class="card-actions">
                                <a
                                    href="{% url 'cart:cart_detail' %}"
                                    class="btn btn-primary btn-block"
                                >
                                    Review Your Order
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin-Style Theme Selector -->
                <button
                    @click="cycleTheme()"
                    class="theme-selector btn btn-ghost btn-circle mr-2"
                    :title="getThemeTitle()"
                >
                    <!-- Light Theme Icon -->
                    <svg
                        x-show="currentTheme === 'light'"
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.464 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                            clip-rule="evenodd"
                        />
                    </svg>

                    <!-- Dark Theme Icon -->
                    <svg
                        x-show="currentTheme === 'dark'"
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                    >
                        <path
                            d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                        />
                    </svg>

                    <!-- System/Auto Theme Icon -->
                    <svg
                        x-show="currentTheme === 'auto'"
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                        />
                    </svg>
                </button>
            </div>
        </div>

        {% block content %} {% endblock %}

        <!-- Theme Management Script -->
        <script>
            function themeManager() {
                return {
                    currentTheme: localStorage.getItem("theme") || "auto",

                    initTheme() {
                        this.setTheme(this.currentTheme);
                    },

                    setTheme(theme) {
                        this.currentTheme = theme;

                        if (theme === "auto") {
                            // Use system preference
                            const systemTheme = window.matchMedia(
                                "(prefers-color-scheme: dark)",
                            ).matches
                                ? "dark"
                                : "light";
                            document.documentElement.setAttribute(
                                "data-theme",
                                systemTheme,
                            );
                        } else {
                            document.documentElement.setAttribute(
                                "data-theme",
                                theme,
                            );
                        }

                        localStorage.setItem("theme", theme);
                    },

                    cycleTheme() {
                        const themes = ["light", "dark", "auto"];
                        const currentIndex = themes.indexOf(this.currentTheme);
                        const nextIndex = (currentIndex + 1) % themes.length;
                        this.setTheme(themes[nextIndex]);
                    },

                    getThemeTitle() {
                        const titles = {
                            light: "Light Mode (click to switch to Dark)",
                            dark: "Dark Mode (click to switch to Auto)",
                            auto: "Auto Mode (click to switch to Light)",
                        };
                        return (
                            titles[this.currentTheme] || "Click to change theme"
                        );
                    },
                };
            }

            // Listen for system theme changes when auto is selected
            window
                .matchMedia("(prefers-color-scheme: dark)")
                .addEventListener("change", (e) => {
                    const currentTheme = localStorage.getItem("theme");
                    if (currentTheme === "auto") {
                        document.documentElement.setAttribute(
                            "data-theme",
                            e.matches ? "dark" : "light",
                        );
                    }
                });
        </script>

        <!-- Cart Management JavaScript -->
        <script src="{% static 'js/cart.js' %}"></script>

        {% block extra_js %} {% endblock %}
    </body>
</html>
